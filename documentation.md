## Документация к серверу

# Ограничения
<!-- TODO: сделать -->

# Формат входящих/исходящих сообщений

Сервер принимает только этот формат сообщений, остальные - игнорируются

1) первые 20 символов должны быть строковым представлением ID сообщения (у исходящих сообщений равен нулю), причем если ID меньше 20-ти символов, оставшиеся символы должны быть заполнены ведущими нулями.
2) следующие 10 символов - строковое представление даты отправки сообщения в секундах с 1 января 1970 00:00:00 UTC (epoch time).
3) следующие 32 символа - имя пользователя (username) отправителя сообщения, если имя пользователя меньше 32 символов, ведущие символы должны быть заполнены пробелами (ascii: 32).
4) аналогично следующие 32 символа - имя пользователя (username) получателя сообщения. действуют те же правила, однако не действует ограничение на имена пользоваетлей, если имя начинается с воклицательного знака (ascii: 33).
5) все символы далее (1024 максимум, кроме [одного случая]()) - само сообщение (пока что в незашифрованном виде)

итоговый вид сообщения:\
`< 20 id | 10 datetime | 32 sender | 32 destination | 1024 message >`

# Формат запросов/ответов

## Запросы
Запросы осуществляются как обычные сообщения из блока выше, но получателем является особый пользователь **`!server.req`**. Далее предоставлен список возможных команд для запроса, еще ниже - формат ответа на запрос

 - [x] `!ping`
 - [x] `!contact`
 - [x] `!login`
 - [x] `!register`
 - [ ] `!join`
 - [ ] `!leave`
 - [ ] `!create`
 - [ ] `!profile`
 - [ ] `!chat`
 - [ ] `!read`
 - [ ] `!unread`
 - [ ] `!msg`
 - [ ] `!getUnread`

## Ответы
Ответы так же являются обычными сообщениями, однако их message-составляющая (последние 1024 символа) является особым форматом:\
с начала идет строка `REQ:`, далее сам запрос (то сообщение, что вы отправили на сервер), далее идет специальный символ-разделитель (Record-separator, ascii: 30, `"\u001E"` JS/TS), затем строка `RSP:` , после которой непосредственно ответ на запрос.\
**!!! ВАЖНО !!!**\
формат ответа (RSP) может отличаться от команды к команде, это лишь глобальный формат общего ответа, RSP придется обрабатывать отдельно в зависимости от самого запроса.

## Синтаксис
Синтаксис команд и формат ответа от них

### !ping
    !ping
не принимает аргументов, сервер всегда возвращает строку `pong`. используется для проверки соединения (Debug)

**Пример:**
```
!ping
```

### !contact
    !contact <action> <arg?> <name?>

*Операции с контактами*\
всегда принимает первым аргуметом действие, а далее в зависимости от действия:
 - `add`: **добавляет пользователя в контакты с заданным именем.** первый аргумент - имя пользователя, для добавления в контакты; второй - имя контакта. ***ВОЗВРАЩАЕТ: `+` если успешно, иначе `-`***
 - `rem`: **удаляет контакт по у пользователя.** первый аргумент - имя пользователя, для удаления контакта. ***ВОЗВРАЩАЕТ: `+` если успешно, иначе `-`***
 - `get`: **получить сохраненное имя контакта у пользователя.** первый аргумент - имя пользователя, для получения контакта. ***ВОЗВРАЩАЕТ: сохранненое имя контакта или пустую строку***

### !login
    !login <username> <password_hash>

*Вход в аккаунт*
всегда принимает логин и хэш пароля

***ВОЗВРАЩАЕТ: `success` если успешно, `fail_username` - ошибка в имени пользователя, `fail_password` - неверный пароль***

### !register
    !register <username> <password_hash>

*Регистрация аккаунта*
всегда принимает логин и хэш пароля

***ВОЗВРАЩАЕТ: `success` если успешно, `fail_username` - ошибка в имени пользователя (уже существует)***