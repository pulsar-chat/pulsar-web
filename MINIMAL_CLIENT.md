# Минимальный рабочий клиент Pulsar

## Описание
Создан минимальный рабочий клиент для Pulsar Messenger на основе существующей инфраструктуры проекта. Клиент полностью функционален и готов к использованию.

## Реализованные функции

### 1. Подключение к серверу
- Соединение с WebSocket сервером `wss://pulsar-chat.ru/ws`
- Автоматическое переподключение при разрыве соединения
- Обработка событий открытия, закрытия и ошибок соединения

### 2. Аутентификация
- **Автоматический вход**: Клиент проверяет сохраненные cookies (`pulsar_user`, `pulsar_pass`) и автоматически входит
- **Default пользователь**: Если cookies не найдены, клиент использует `@browser` в качестве демо-пользователя
- Удаление неверных credentials при ошибке входа

### 3. Отправка и получение сообщений
- Отправка сообщений в текущий чат (по умолчанию в диалог с собой)
- Получение сообщений от сервера и других пользователей
- Отображение сообщений в UI с временными метками
- Auto-scroll к последнему сообщению

### 4. Интеграция UI
- **Поле для ввода**: textarea с автофокусом после отправки
- **Кнопка отправки**:ClickListener на кнопку "➤"
- **Горячая клавиша**: Enter отправляет сообщение (Shift+Enter для новой строки)
- **Отображение сообщений**: Левые пузырьки от других, правые от пользователя
- **Заголовок чата**: Отображает статус и имя чата

### 5. Обработка ошибок
- Логирование ошибок в консоль
- Отображение ошибок в UI
- Обработка ошибок от сервера (`!server.error`)

## Структура файлов

```
src/
├── main.ts          ← Минимальный клиент (обновлен)
├── client.ts        ← PulsarClient класс (существовал)
├── message.ts       ← Message класс (существовал)
├── websocket/pulsar.ts ← WebSocket обработка (существовала)
├── cookie.ts        ← Cookie управление (существовал)
└── config.ts        ← Конфигурация (существовал)

client.html         ← Очищен от примеров сообщений
```

## Как использовать

### Разработка
```bash
npm run dev
```
Открыть `http://localhost:5173/client`

### Продакшн
```bash
npm run build
npm run preview
```

### Тестирование
```bash
npm run test
```

## Примеры использования

### Вход в аккаунт
Откройте браузер и перейдите на `/login` для входа. После входа credentials будут сохранены в cookies и клиент автоматически войдет при следующем открытии.

### Отправка сообщения
1. Введите текст в textarea
2. Нажмите кнопку "➤" или нажмите Enter
3. Сообщение будет отправлено и отображено в UI

### Поддерживаемые команды сервера
Клиент поддерживает все команды сервера через `cli.requestRaw()`:
- `!ping` - проверка соединения
- `!login <username> <password_hash>` - вход
- `!register <username> <password_hash>` - регистрация
- `!join <channel>` - присоединиться к каналу
- `!chat <chat> <lines>` - получить историю сообщений
- И другие команды согласно документации

## API клиента

### Основной класс PulsarClient

```typescript
class PulsarClient {
    // Событие при открытии соединения
    onOpen: (() => void) | null;
    
    // Событие при закрытии соединения  
    onClose: ((ev: CloseEvent) => void) | null;
    
    // Событие при ошибке
    onError: ((ev: Event) => void) | null;
    
    // Событие при получении сообщения
    onMessage: ((msg: Message) => void) | null;
    
    // Способы
    connect(): void;
    send(content: string, receiver: string): void;
    requestRaw(req: string): Promise<string>;
}
```

## Примечания

- Клиент минимален и содержит только необходимой функционал
- Все сообщения логируются в консоль браузера
- Поддерживается авто-переподключение при разрыве соединения
- Временные метки отображаются в локальном формате браузера

## Дальнейшее развитие

Для расширения функциональности можно добавить:
- Список контактов с отдельными чатами
- Просмотр истории сообщений
- Уведомления о новых сообщениях
- Управление профилем пользователя
- Создание и управление каналами
